---
title: "Regression Evaluation & Insights"
author: "Provided by AutoQuant"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  prettydoc::html_pretty:
    theme: RemixAutoML
    toc: yes
    toc_depth: 2
    fig_caption: yes
    number_sections: yes
classoption: landscape
---

```{r Environment, include=FALSE}
# theme options up top: hpstr, cayman, architect, AutoQuant
knitr::opts_chunk$set(echo = TRUE)
temp <- globalenv()
TempNames <- names(temp)
for(nam in TempNames) {
  assign(x = nam, value = eval(temp[[nam]]), envir = .GlobalEnv)
}
```

```{r ModelObject_DataSets_And_MetaData, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # DataSets
  TestData <- ModelObject[['TestData']]
  TrainData <- ModelObject[['TrainData']]
  
  # Meta info
  TargetColumnName <- ModelObject[['ArgsList']][['TargetColumnName']]
  PredictionColumnName <- 'Predict'
  if(is.null(FeatureColumnNames)) {
    FeatureColumnNames <- ModelObject[['ColNames']][[1L]]
  }
  if(is.null(DateColumnName) && !is.null(ModelObject[['ArgsList']][['PrimaryDateColumn']])) {
    DateColumnName <- ModelObject[['ArgsList']][['PrimaryDateColumn']]
  } else {
    DateColumnName <- NULL
  }
}
```

```{r ModelObject_Model_MetaData, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # Model MetaData ----

  ## Model_MetaData_Parameters ----
  ArgsList <- ModelObject[['ArgsList']]
  
  ## Model_MetaData_GridMetrics ----
  GridMetrics <- ModelObject[['GridMetrics']]
  
}
``` 

```{r ModelObject_Evaluation_Metrics, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # Evaluation Metrics ----
  
  ## Model_Evaluation_Metrics ----
  Test_EvalMetrics <- ModelObject[['EvaluationMetrics']][['TestData']]
  Train_EvalMetrics <- ModelObject[['EvaluationMetrics']][['TrainData']]
  
  ## Model_VarImportanceTable ----
  if(tolower(Algo) == 'catboost') {
    
    # Store data
    Test_Importance <- ModelObject[['VariableImportance']][['Test_Importance']]
    Validation_Importance <- ModelObject[['VariableImportance']][['Validation_Importance']]
    Train_Importance <- ModelObject[['VariableImportance']][['Train_Importance']]

    # Update Colnames
    if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = 'Importance', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Importance)) data.table::setnames(Validation_Importance, old = 'Importance', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Importance)) data.table::setnames(Train_Importance, old = 'Importance', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- NULL
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
      All_Importance <- merge(All_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Validation_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- Train_Importance
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Validation_Importance
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }

  } else {

    #### Encoding-Based Models
    if(is.null(Test_Importance_dt)) {
      Test_Importance <- NULL
    } else {
      Test_Importance <- Test_Importance_dt
    }
    if(is.null(Validation_Importance_dt)) {
      Validation_Importance <- NULL
    } else {
      Validation_Importance <- Validation_Importance_dt
    }
    if(is.null(Train_Importance_dt)) {
      Train_Importance <- ModelObject[['VariableImportance']]
    } else {
      Train_Importance <- Train_Importance_dt
    }
    
    # Update Colnames
    if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = 'Importance', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Importance)) data.table::setnames(Validation_Importance, old = 'Importance', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Importance)) data.table::setnames(Train_Importance, old = 'Importance', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- NULL
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
      All_Importance <- merge(All_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Validation_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- Train_Importance
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Validation_Importance
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }
    
  }
  
  ## Model_IntImportanceTable ----
  if(tolower(Algo) == 'catboost') {
    Test_Interaction <- ModelObject[['InteractionImportance']][['Test_Interaction']]
    Validation_Interaction <- ModelObject[['InteractionImportance']][['Validation_Interaction']]
    Train_Interaction <- ModelObject[['InteractionImportance']][['Train_Interaction']]
    
    # Update Colnames
    if(!is.null(Test_Interaction)) data.table::setnames(Test_Interaction, old = 'score', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Interaction)) data.table::setnames(Validation_Interaction, old = 'score', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Interaction)) data.table::setnames(Train_Interaction, old = 'score', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- NULL
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      All_Interaction <- merge(All_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Validation_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- Train_Interaction
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Validation_Interaction
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Test_Interaction
    } else {
      All_Interaction <- NULL
    }
  }
}
``` 

```{r Generic_DataSets_And_MetaData, echo = FALSE}
if(is.null(ModelObject)) {
  
  # DataSets
  if(is.null(TestData) && file.exists(file.path(SourcePath, paste0(ModelID, "_ValidationData.csv")))) {
    TestData <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_ValidationData.csv")))
  }
  # Validate
  if(is.null(ValidationData) && file.exists(file.path(SourcePath, paste0(ModelID, "_ValData.csv")))) {
    ValidationDataData <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_ValData.csv")))
  }
  # Train
  if(is.null(TrainData) && file.exists(file.path(SourcePath, paste0(ModelID, "_TrainData.csv")))) {
    TrainData <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_TrainData.csv")))
  }
  
  # Meta info
  TargetColumnName <- TargetColumnName
  PredictionColumnName <- PredictionColumnName
  if(is.null(FeatureColumnNames) && !is.null(TestData)) {
    FeatureColumnNames <- names(TestData)[!names(TestData) %in% c(TargetColumnName, PredictionColumnName)]
  }
  if(is.null(FeatureColumnNames) && !is.null(ValidationData)) {
    FeatureColumnNames <- names(ValidationData)[!names(ValidationData) %in% c(TargetColumnName, PredictionColumnName)]
  }
  if(is.null(FeatureColumnNames) && !is.null(TrainData)) {
    FeatureColumnNames <- names(TrainData)[!names(TrainData) %in% c(TargetColumnName, PredictionColumnName)]
  }
  if(is.list(FeatureColumnNames) || data.table::is.data.table(FeatureColumnNames)) {
    FeatureColumnNames <- FeatureColumnNames[[1L]]
  }
  if(is.null(DateColumnName) && !is.null(ModelObject[['ArgsList']][['PrimaryDateColumn']])) {
    DateColumnName <- ModelObject[['ArgsList']][['PrimaryDateColumn']]
  } else {
    DateColumnName <- NULL
  }
}
```

```{r Generic_Global_Objects, echo = FALSE}
if(is.null(ModelObject)) {

  # Global (Output feeds into Scatterplot and Copula Plot Chunks) ----

  ## Test_ResidualsPlots ----
  if(!is.null(TestData)) {
    Test_ResidualPlot <- AutoQuant::ResidualPlots(
      TestData = data.table::copy(TestData), 
      Target = TargetColumnName,
      Predicted = 'Predict',
      DateColumnName = NULL,
      Gam_Fit = FALSE)
  } else {
    Test_ResidualPlot <- NULL
  }

  ## Train_ResidualsPlots ----
  if(!is.null(TrainData)) {
    Train_ResidualPlot <- AutoQuant::ResidualPlots(
      TestData = data.table::copy(TrainData),
      Target = TargetColumnName,
      Predicted = 'Predict',
      DateColumnName = NULL,
      Gam_Fit = FALSE)
  } else {
    Train_ResidualPlot <- NULL
  }
}
```

```{r Generic_Model_MetaData, echo = FALSE}
if(is.null(ModelObject)) {

  # Model MetaData ----

  ## Model_MetaData_Parameters ----
  if(!is.null(SourcePath) && !is.null(ModelID)) {
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_ArgsList.Rdata")))) {
      load(file.path(SourcePath, paste0(ModelID, "_ArgsList.Rdata")))
    }
  } else {
    ArgsList <- NULL
  }

  ## Model_MetaData_GridMetrics ----
  if(!is.null(SourcePath) && !is.null(ModelID)) {
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_GridMetrics.csv")))) {
      GridMetrics <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_GridMetrics.csv")))
    } else {
      GridMetrics <- NULL
    }
  } else {
    GridMetrics <- NULL
  }
}
```
  
```{r Generic_Evaluation_Metrics, echo = FALSE}  
if(is.null(ModelObject)) {
  
  # Evaluation Metrics ----
    
  ## Model_Evaluation_Metrics ----
  
  ### Test
  if(!is.null(TestData) && !is.null(TrainData) && !file.exists(file.path(SourcePath, paste0(ModelID, "_Test_EvaluationMetrics.csv")))) {
    Test_EvalMetrics <- AutoQuant:::RegressionMetrics(
      SaveModelObjects. = FALSE,
      data.           = TrainData,
      ValidationData. = TestData,
      TrainOnFull. = TRUE,
      LossFunction. = 'mse',
      EvalMetric. = 'RMSE',
      TargetColumnName. = TargetColumnName,
      ModelID. = ModelID,
      model_path. = SourcePath,
      metadata_path. = SourcePath)
  } else if(!is.null(TestData) && is.null(TrainData) && !file.exists(file.path(SourcePath, paste0(ModelID, "_Test_EvaluationMetrics.csv")))) {
    Test_EvalMetrics <- AutoQuant:::RegressionMetrics(
      SaveModelObjects. = FALSE,
      data.           = TestData,
      ValidationData. = TestData,
      TrainOnFull. = TRUE,
      LossFunction. = 'mse',
      EvalMetric. = 'RMSE',
      TargetColumnName. = TargetColumnName,
      ModelID. = ModelID,
      model_path. = SourcePath,
      metadata_path. = SourcePath)
  } else if(file.exists(file.path(SourcePath, paste0(ModelID, "_Test_EvaluationMetrics.csv")))) {
    Test_EvalMetrics <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Test_EvaluationMetrics.csv")))
  } else {
    Test_EvalMetrics <- NULL
  }

  ### Train
  if(!is.null(TrainData) && !file.exists(file.path(SourcePath, paste0(ModelID, "_Train_EvaluationMetrics.csv")))) {
    Train_EvalMetrics <- AutoQuant:::RegressionMetrics(
      SaveModelObjects. = FALSE,
      data. = TrainData,
      ValidationData. = TrainData,
      TrainOnFull. = TRUE,
      LossFunction. = 'mse',
      EvalMetric. = 'RMSE',
      TargetColumnName. = TargetColumnName,
      ModelID. = ModelID,
      model_path. = SourcePath,
      metadata_path. = SourcePath)
  } else if(file.exists(file.path(SourcePath, paste0(ModelID, "_Train_EvaluationMetrics.csv")))) {
    Train_EvalMetrics <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Train_EvaluationMetrics.csv")))
  } else {
    Train_EvalMetrics <- NULL
  }
  
  ## Model_VarImportanceTable ----
  if(tolower(Algo) == 'catboost') {
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Test_Importance_VariableImportance.csv")))) {
      Test_Importance <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Test_Importance_VariableImportance.csv")))
    } else {
      Test_Importance <- NULL
    }
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Validation_Importance_VariableImportance.csv")))) {
      Validation_Importance <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Validation_Importance_VariableImportance.csv")))
    } else {
      Validation_Importance <- NULL
    }
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Train_Importance_VariableImportance.csv")))) {
      Train_Importance <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Train_Importance_VariableImportance.csv")))
    } else {
      Train_Importance <- NULL
    }
    
    # Update Colnames
    if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = 'Importance', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Importance)) data.table::setnames(Validation_Importance, old = 'Importance', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Importance)) data.table::setnames(Train_Importance, old = 'Importance', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- NULL
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
      All_Importance <- merge(All_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Validation_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- Train_Importance
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Validation_Importance
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }
    
  } else {
    
    # Encoding-based Models + Generic Connector
    if(is.null(Test_Importance_dt)) {
      Test_Importance <- NULL
    } else {
      Test_Importance <- Test_Importance_dt
    }
    if(is.null(Validation_Importance_dt)) {
      Validation_Importance <- NULL
    } else {
      Validation_Importance <- Validation_Importance_dt
    }
    if(is.null(Train_Importance_dt)) {
      Train_Importance <- NULL
    } else {
      Train_Importance <- Train_Importance_dt
    }
    
    # Update Colnames
    if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = 'Importance', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Importance)) data.table::setnames(Validation_Importance, old = 'Importance', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Importance)) data.table::setnames(Train_Importance, old = 'Importance', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- NULL
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
      All_Importance <- merge(All_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Validation_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- Train_Importance
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Validation_Importance
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }
    
  }
  
  ## Model_IntImportanceTable ----
  if(tolower(Algo) == 'catboost') {
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Test_Interaction_Interaction.csv")))) {
      Test_Interaction <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Test_Interaction_Interaction.csv")))
    } else {
      Test_Interaction <- NULL
    }
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Validation_Interaction_Interaction.csv")))) {
      Validation_Interaction <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Validation_Interaction_Interaction.csv")))
    } else {
      Validation_Interaction <- NULL
    }
    if(file.exists(file.path(SourcePath, paste0(ModelID, "_Train_Interaction_Interaction.csv")))) {
      Train_Interaction <- data.table::fread(file = file.path(SourcePath, paste0(ModelID, "_Train_Interaction_Interaction.csv")))
    } else {
      Train_Interaction <- NULL
    }
    
    # Update Colnames
    if(!is.null(Test_Interaction)) data.table::setnames(Test_Interaction, old = 'score', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Interaction)) data.table::setnames(Validation_Interaction, old = 'score', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Interaction)) data.table::setnames(Train_Interaction, old = 'score', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- NULL
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      All_Interaction <- merge(All_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Validation_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- Train_Interaction
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Validation_Interaction
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Test_Interaction
    } else {
      All_Interaction <- NULL
    }
    
  } else {
    
    # Encoding-based Models + Generic Connector
    if(is.null(Test_Interaction_dt)) {
      Test_Interaction <- NULL
    } else {
      Test_Interaction <- Test_Interaction_dt
    }
    if(is.null(Validation_Interaction_dt)) {
      Validation_Interaction <- NULL
    } else {
      Validation_Interaction <- Validation_Interaction_dt
    }
    if(is.null(Train_Interaction_dt)) {
      Train_Interaction <- NULL
    } else {
      Train_Interaction <- Train_Interaction_dt
    }
    
    # Update Colnames
    if(!is.null(Test_Interaction)) data.table::setnames(Test_Interaction, old = 'score', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Interaction)) data.table::setnames(Validation_Interaction, old = 'score', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Interaction)) data.table::setnames(Train_Interaction, old = 'score', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- NULL
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      All_Interaction <- merge(All_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Validation_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Test_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- merge(Validation_Interaction, Train_Interaction, by = c('Features1','Features2'), all = TRUE)
      data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1)
    } else if(is.null(Test_Interaction) && is.null(Validation_Interaction) && !is.null(Train_Interaction)) {
      All_Interaction <- Train_Interaction
    } else if(is.null(Test_Interaction) && !is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Validation_Interaction
    } else if(!is.null(Test_Interaction) && is.null(Validation_Interaction) && is.null(Train_Interaction)) {
      All_Interaction <- Test_Interaction
    } else {
      All_Interaction <- NULL
    }
  }
}
```

```{r Generic_Evaluation_Plots, echo = FALSE}

# Evaluation Plots ----
  
## EvaluationPlots_ResidualHistogram ----

### Test
Test_ResidualHistogram <- AutoPlots::Plot.Residuals.Histogram(
  dt = TestData,
  AggMethod = "mean",
  SampleSize = 100000,
  XVar = 'Predict',
  YVar = TargetColumnName,
  GroupVar = NULL,
  YVarTrans = "Identity",
  XVarTrans = "Identity",
  FacetRows = 1,
  FacetCols = 1,
  FacetLevels = NULL,
  NumberBins = 20,
  Height = "600px",
  Width = "1100px",
  Title = "Residuals Histogram",
  ShowLabels = FALSE,
  Title.YAxis = NULL,
  Title.XAxis = NULL,
  Engine = "Echarts",
  EchartsTheme = "dark",
  TimeLine = FALSE,
  X_Scroll = TRUE,
  Y_Scroll = TRUE,
  BackGroundColor = "#6a6969",
  ChartColor = "#001534",
  FillColor = "#0066ff",
  FillColorReverse = "#97ff00",
  GridColor = "white",
  TextColor = "white",
  ZeroLineColor = "#ffff",
  ZeroLineWidth = 1.25,
  title.fontSize = 22,
  title.fontWeight = "bold",
  title.textShadowColor = "#63aeff",
  title.textShadowBlur = 3,
  title.textShadowOffsetY = 1,
  title.textShadowOffsetX = -1,
  xaxis.fontSize = 14,
  yaxis.fontSize = 14,
  Debug = FALSE)

### Train
if(length(TrainData) > 0L) {
  Train_ResidualHistogram <- AutoPlots::Plot.Residuals.Histogram(
    dt = TrainData,
    AggMethod = "mean",
    SampleSize = 100000,
    XVar = 'Predict',
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 20,
    Height = "600px",
    Width = "1100px",
    Title = "Residuals Histogram",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
}


## EvaluationPlots_CalibrationPlot ----

### Test
Test_EvaluationPlot <- AutoPlots::Plot.Calibration.Line(
  dt = TestData,
  AggMethod = "mean",
  XVar = 'Predict',
  YVar = TargetColumnName,
  GroupVar = NULL,
  YVarTrans = "Identity",
  XVarTrans = "Identity",
  FacetRows = 1,
  FacetCols = 1,
  FacetLevels = NULL,
  NumberBins = 21,
  Height = "600px",
  Width = "1100px",
  Title = "Calibration Line Plot",
  ShowLabels = FALSE,
  Title.YAxis = NULL,
  Title.XAxis = NULL,
  Engine = "Echarts",
  EchartsTheme = "dark",
  TimeLine = FALSE,
  X_Scroll = TRUE,
  Y_Scroll = TRUE,
  BackGroundColor = "#6a6969",
  ChartColor = "#001534",
  FillColor = "#0066ff",
  FillColorReverse = "#97ff00",
  GridColor = "white",
  TextColor = "white",
  ZeroLineColor = "#ffff",
  ZeroLineWidth = 1.25,
  Debug = FALSE)

### Train
if(!is.null(TrainData)) {
  Train_EvaluationPlot <- AutoPlots::Plot.Calibration.Line(
    dt = TrainData,
    AggMethod = "mean",
    XVar = 'Predict',
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 21,
    Height = "600px",
    Width = "1100px",
    Title = "Calibration Line Plot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    Debug = FALSE)
}

## EvaluationPlots_CalibrationBoxPlot ----

### Test
Test_EvaluationBoxPlot <- AutoPlots::Plot.Calibration.Box(
  dt = TestData,
  SampleSize = 100000L,
  AggMethod = "mean",
  XVar = 'Predict',
  YVar = TargetColumnName,
  GroupVar = NULL,
  YVarTrans = "Identity",
  XVarTrans = "Identity",
  FacetRows = 1,
  FacetCols = 1,
  FacetLevels = NULL,
  NumberBins = 21,
  Height = "600px",
  Width = "1100px",
  Title = "Calibration Plot",
  ShowLabels = FALSE,
  Title.YAxis = NULL,
  Title.XAxis = NULL,
  Engine = "Echarts",
  EchartsTheme = "dark",
  TimeLine = FALSE,
  X_Scroll = TRUE,
  Y_Scroll = TRUE,
  BackGroundColor = "#6a6969",
  ChartColor = "#001534",
  FillColor = "#0066ff",
  FillColorReverse = "#97ff00",
  GridColor = "white",
  TextColor = "white",
  ZeroLineColor = "#ffff",
  ZeroLineWidth = 1.25,
  Debug = FALSE)

### Train
if(!is.null(TrainData)) {
  Train_EvaluationBoxPlot <- AutoPlots::Plot.Calibration.Box(
    dt = TrainData,
    SampleSize = 100000L,
    AggMethod = "mean",
    XVar = 'Predict',
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 21,
    Height = "600px",
    Width = "1100px",
    Title = "Calibration Plot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    Debug = FALSE)
}

## EvaluationPlots_ResidualsScatterPlot (depends on ) ----
Test_ScatterPlot <- AutoPlots::Plot.Residuals.Scatter(
  dt = TestData,
  AggMethod = "mean",
  SampleSize = 100000,
  XVar = "Predict",
  YVar = TargetColumnName,
  GroupVar = NULL,
  YVarTrans = "Identity",
  XVarTrans = "Identity",
  FacetRows = 1,
  FacetCols = 1,
  FacetLevels = NULL,
  Height = "600px",
  Width = "1100px",
  Title = "Calibration Plot",
  ShowLabels = FALSE,
  Title.YAxis = NULL,
  Title.XAxis = NULL,
  Engine = "Echarts",
  EchartsTheme = "dark",
  TimeLine = FALSE,
  X_Scroll = TRUE,
  Y_Scroll = TRUE,
  BackGroundColor = "#6a6969",
  ChartColor = "#001534",
  FillColor = "#0066ff",
  FillColorReverse = "#97ff00",
  GridColor = "white",
  TextColor = "white",
  ZeroLineColor = "#ffff",
  ZeroLineWidth = 1.25,
  Debug = FALSE)

if(length(TrainData) > 0L) {
  Train_ScatterPlot <- AutoPlots::Plot.Residuals.Scatter(
    dt = TrainData,
    AggMethod = "mean",
    SampleSize = 100000,
    XVar = "Predict",
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    Height = "600px",
    Width = "1100px",
    Title = "Residuals ScatterPlot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    Debug = FALSE)
}

```

```{r ModelObject_Model_Interpretation, echo = FALSE}

# Model Interpretation ----

## Model_Evaluation_Metrics_NumericVariables ----

### TestData ----

# Plots to Add and Remove

# Starting batch of plots
Test_ParDepPlots <- list()
  
# Add Plots
if(!is.null(TestData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TestData[[g]])) {
      
      # Add
      Test_ParDepPlots[[g]] <- AutoPlots::Plot.PartialDependence.Line(
        dt = TestData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}

### TrainData ----

# Plots to Add and Remove

# Starting batch of plots
Train_ParDepPlots <- list() # ModelObject[['PlotList']][['Train_ParDepPlots']]

# Add Plots
if(!is.null(TrainData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TrainData[[g]])) {

      # Add
      Train_ParDepPlots[[g]] <- AutoPlots::Plot.PartialDependence.Line(
        dt = TrainData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}

## Model_Evaluation_Metrics_NumericVariables_Box ----
  
### Test Data ----
  
# Starting batch of plots
Test_ParDepBoxPlots <- list()

# Add Plots
if(!is.null(TestData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TestData[[g]])) {

      # Add
      Test_ParDepBoxPlots[[g]] <- AutoPlots::Plot.PartialDependence.Box(
        dt = TestData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}
  
### Train Data ----

# Starting batch of plots
Train_ParDepBoxPlots <- list()

# Add Plots
if(!is.null(TrainData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TrainData[[g]])) {

      # Add
      Train_ParDepBoxPlots[[g]] <- AutoPlots::Plot.PartialDependence.Box(
        dt = TrainData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}
  
## Model_Evaluation_Metrics_CategoricalVariables ---- 

### Test Data ----

# Starting batch of plots
Test_ParDepCatPlots <- list()
  
# Add Plots
if(!is.null(TestData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(!is.numeric(TestData[[g]])) {
      
      Test_ParDepCatPlots[[g]] <- AutoPlots::Plot.PartialDependence.HeatMap(
        dt = TestData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}
  
### Train Data ----

# Starting batch of plots
Train_ParDepCatPlots <- list()

# Add Plots
if(!is.null(TrainData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(!is.numeric(TrainData[[g]])) {
      
      Train_ParDepCatPlots[[g]] <- AutoPlots::Plot.PartialDependence.HeatMap(
        dt = TrainData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        Height = "600px",
        Width = "1100px",
        Title = "Partial Dependence Line",
        ShowLabels = FALSE,
        Title.YAxis = NULL,
        Title.XAxis = NULL,
        Engine = "Echarts",
        EchartsTheme = "dark",
        EchartsLabels = FALSE,
        TimeLine = TRUE,
        X_Scroll = TRUE,
        Y_Scroll = TRUE,
        BackGroundColor = "#6a6969",
        ChartColor = "#001534",
        FillColor = "#0066ff",
        FillColorReverse = "#97ff00",
        GridColor = "white",
        TextColor = "white",
        ZeroLineColor = "#ffff",
        ZeroLineWidth = 1.25,
        Debug = FALSE)
    }
  }
}

```

Model Evaluation and Insights:

- Provide a wide range of output to investigate high level performance and insights

- Deliver high quality report design layout to reduce time to delivery of info

This report is for investigating model performance from a variety of perspectives. Each section has its own content that can be viewed if expanded. Output exists for both TestData (out of sample) and TrainData (some cases can have ValidationData results as well) for comparison purposes.


# <font size="6">Evaluation Metrics</font>
<p>

<details><summary>Expand to view content</summary>
<p>



##  <font size="5">Evaluation Metrics Tables</font>

<details><summary>Model Metrics Tables</summary>
<p>


### **TestData**
<p>

<details><summary>Performance Metrics</summary>
<p>

```{r Model_Evaluation_Metrics, echo=FALSE}
if(!is.null(Test_EvalMetrics)) {
  knitr::kable(Test_EvalMetrics)
} else {
  print('Test_EvalMetrics is NULL')
}
```

</details>
</p>


### **TrainData + ValidationData**
<p>

<details><summary>Performance Metrics</summary>
<p>

```{r Model_Evaluation_Metrics_Train, echo=FALSE}
if(!is.null(Train_EvalMetrics)) {
  print(knitr::kable(Train_EvalMetrics))
} else {
  print('Train_EvalMetrics is NULL')
}
```

</details>
</p>



##  <font size="5">Variable Importance Tables</font>
<p>

<details><summary>Variable Importance Table</summary>
<p>

```{r Model_VarImportanceTable, echo=FALSE}
if(!is.null(All_Importance)) {
  data.table::setorderv(x = All_Importance, cols = names(All_Importance)[2L], order = -1L, na.last = TRUE)
  print(knitr::kable(All_Importance))
} else {
  print("No importance data was provided")
}
```

</details>
</p>




##  <font size="5">Interaction Importance Tables</font>

<details><summary>Interaction Importance Tables</summary>
<p>


```{r Model_IntImportanceTable, echo=FALSE}
if(exists("All_Interaction") && !is.null(All_Interaction)) {
  data.table::setorderv(x = All_Interaction, cols = names(All_Importance)[3L], order = -1L, na.last = TRUE)
  print(knitr::kable(All_Interaction))
} else {
  print('No interaction importance data was provided')
}
```



</details>
</p>



</details>
</p>





# <font size="6">Evaluation Plots</font>
<p>

<details><summary>Expand to view content</summary>
<p>



## <font size="5">Variable Importance Plots</font>
<p>

<details><summary>Expand to view content</summary>
<p>


```{r EvaluationPlots_VIPlot, echo=FALSE}
print('Test Data Variable Importance')
if(!is.null(Test_Importance)) {
  if("Train_Importance" %in% names(Test_Importance)) data.table::setnames(Test_Importance, 'Train_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Test_Importance)) data.table::setnames(Test_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Test_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    Height = "600px",
    Width = "1100px",
    Title = "Variable Importance Plot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
} else {
  print("Test_Importance is NULL")
}
print('Validation Data Variable Importance')
if(!is.null(Validation_Importance)) {
  if("Validation_Importance" %in% names(Validation_Importance)) data.table::setnames(Validation_Importance, 'Validation_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Validation_Importance)) data.table::setnames(Validation_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Validation_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    Height = "600px",
    Width = "1100px",
    Title = "Variable Importance Plot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
} else {
  print("Validation_Importance is NULL")
}
print('Train Data Variable Importance')
if(!is.null(Train_Importance)) {
  if("Train_Importance" %in% names(Train_Importance)) data.table::setnames(Train_Importance, 'Train_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Train_Importance)) data.table::setnames(Train_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Train_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    Height = "600px",
    Width = "1100px",
    Title = "Variable Importance Plot",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    Engine = "Echarts",
    EchartsTheme = "dark",
    TimeLine = FALSE,
    X_Scroll = TRUE,
    Y_Scroll = TRUE,
    BackGroundColor = "#6a6969",
    ChartColor = "#001534",
    FillColor = "#0066ff",
    FillColorReverse = "#97ff00",
    GridColor = "white",
    TextColor = "white",
    ZeroLineColor = "#ffff",
    ZeroLineWidth = 1.25,
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
  
} else {
  print("Train_Importance is NULL")
}
```

</details>
</p>



## <font size="5">Residual Histograms</font>
<p>

<details><summary>Expand to view content</summary>
<p>

```{r EvaluationPlots_ResidualHistogram, echo=FALSE}
print('Test Data')
if(!is.null(Test_ResidualHistogram)) {
  eval(Test_ResidualHistogram)
} else {
  print('Test_ResidualHistogram is NULL or TestData is NULL')
}
print('Train + Validation Data')
if(!is.null(Train_ResidualHistogram)) {
  eval(Train_ResidualHistogram)
} else {
  print('Train_ResidualHistogram is NULL or TrainData is NULL')
}
```

</details>
</p>




## <font size="5">Calibration Plots</font>
<p>

<details><summary>Expand to view content</summary>
<p>

```{r EvaluationPlots_CalibrationPlot, echo=FALSE}
print('Test Data Evaluation Plots')
if(!is.null(Test_EvaluationPlot)) {
  eval(Test_EvaluationPlot)
} else {
  print('Test_EvaluationPlot is NULL or TestData is NULL')
}
print('Train + Validation Data Evaluation Plots')
if(!is.null(Train_EvaluationPlot)) {
  eval(Train_EvaluationPlot)
} else {
  print('Test_EvaluationPlot is NULL or TrainData is NULL')
}
```

</details>
</p>



## <font size="5">Calibration BoxPlots</font>
<p>


<details><summary>Expand to view content</summary>
<p>


```{r EvaluationPlots_CalibrationBoxPlot, echo=FALSE}
print('Test Data Evaluation Box Plots')
if(!is.null(Test_EvaluationBoxPlot)) {
  eval(Test_EvaluationBoxPlot)
} else {
  print('Test_EvaluationBoxPlot is NULL or TestData is NULL')
}
print('Train + Validation Data Evaluation Box Plots')
if(!is.null(Train_EvaluationBoxPlot)) {
  eval(Train_EvaluationBoxPlot)
} else {
  print('Train_EvaluationBoxPlot is NULL or TrainData is NULL')
}
```

</details>
</p>





## <font size="5">Residuals ScatterPlots</font>
<p>

<details><summary>Expand to view content</summary>
<p>

```{r EvaluationPlots_ResidualsScatterPlot, echo=FALSE}
print('Test Data Scatter Plot')
if(!is.null(Test_ScatterPlot)) {
  eval(Test_ScatterPlot)
} else {
  print('Test_ScatterPlot is NULL or TestData is NULL')
}
print('Train + Validation Data Scatter Plot')
if(!is.null(Train_ScatterPlot)) {
  eval(Train_ScatterPlot)
} else {
  print('Train_ScatterPlot is NULL or TrainData is NULL')
}
```

</details>
</p>



</details>
</p>




# <font size="6">Model Interpretation</font>
<p>

<details><summary>Expand to view content</summary>
<p>



## <font size="5">Partial Dependence Plots: Numeric-Features</font>
<p>

<details><summary>Expand to view content</summary>
<p>


### Partial Dependence Line Plots
<p>

<details><summary>Expand to view content</summary>
<p>


#### **TestData**
<p>

<details><summary>Partital Dependence Line Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables, echo=FALSE}
options(warn = -1)
if(!is.null(Test_ParDepPlots) && length(Test_ParDepPlots) > 0) {
  echarts4r::e_arrange(Test_ParDepPlots)
} else {
  print('Test_ParDepPlots is NULL and TestData is NULL')
}
options(warn = 1)
```

</details>
</p>


#### **TrainData** + **ValidationData**
<p>

<details><summary>Partital Dependence Line Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables_Train, echo=FALSE}
options(warn = -1)
if(!is.null(Train_ParDepPlots) && length(Train_ParDepPlots) > 0) {
  echarts4r::e_arrange(Train_ParDepPlots)
} else {
  print('Train_ParDepPlots is NULL and TrainData is NULL')
}
options(warn = 1)
```

</details>
</p>



### Partial Dependence Box Plots
<p>

<details><summary>Expand to view content</summary>
<p>


#### **TestData**
<p>

<details><summary>Partital Dependence Box Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables_Box, echo=FALSE}
options(warn = -1)
if(!is.null(Test_ParDepBoxPlots) && length(Test_ParDepBoxPlots) > 0) {
  echarts4r::e_arrange(Test_ParDepBoxPlots)
} else {
  print('Test_ParDepBoxPlots is NULL and TestData is NULL')
}
options(warn = 1)
```

</details>
</p>


#### **TrainData** + **ValidationData**
<p>

<details><summary>Partital Dependence Box Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables_Train_Box, echo=FALSE}
options(warn = -1)
if(!is.null(Train_ParDepBoxPlots) && length(Train_ParDepBoxPlots) > 0) {
  echarts4r::e_arrange(Train_ParDepBoxPlots)
} else {
  print('Train_ParDepBoxPlots is NULL and TestData is NULL')
}
options(warn = 1)
```

</details>
</p>



## <font size="5">Partial Partial Dependence Plots: Categorical-Features</font> 
<p>

<details><summary>Expand to view content</summary>
<p>


### **TestData**
<p>

<details><summary>Partital Dependence Bar Plots</summary>
<p>

```{r Model_Evaluation_Metrics_CategoricalVariables, echo=FALSE}
options(warn = -1)
if(!is.null(Test_ParDepCatPlots) && length(Test_ParDepCatPlots) > 0) {
  echarts4r::e_arrange(Test_ParDepCatPlots)
} else {
  print('Test_ParDepCatPlots is NULL and TestData is NULL')
}
options(warn = 1)
```

</details>
</p>


### **TrainData** + **ValidationData**
<p>

<details><summary>Partital Dependence Bar Plots</summary>
<p>

```{r Model_Evaluation_Metrics_CategoricalVariables_Train, echo=FALSE}
options(warn = -1)
if(!is.null(Train_ParDepCatPlots) && length(Train_ParDepCatPlots) > 0) {
  echarts4r::e_arrange(Train_ParDepCatPlots)
} else {
  print('Train_ParDepCatPlots is NULL and TrainData is NULL')
}
options(warn = 1)
```

</details>
</p>


</details>
</p>



</details>
</p>




# <font size="6">Model MetaData</font>
<p>

<details><summary>Expand to view content</summary>
<p>



## <font size="5">Parameters and Settings</font> 

<details><summary>Model Parameters</summary>
<p>

```{r Model_MetaData_Parameters, echo=FALSE}
if(!is.null(ArgsList)) {
  for(nam in names(ArgsList)) print(paste0(nam, ": ", ArgsList[[nam]]))
} else {
  txt <- paste0(ModelID, "_ArgsList.Rdata")
  print(paste0('ArgsList is NULL'))
}
```



## <font size="5">Grid Tuning Metrics</font>

<details><summary>Grid Tuning Metrics</summary>
<p>

```{r Model_MetaData_GridMetrics, echo=FALSE}
if(!is.null(GridMetrics)) {
  print(knitr::kable(GridMetrics[order(-MetricValue)]))
} else {
  print("GridTuning was not conducted")
}
```

</details>
</p>



</details>
</p>



```{js, echo=FALSE}
setTimeout(function() {
  var codes = document.querySelectorAll('.dataTables_wrapper');
  var code, i, d, s, p;
  for (i = 0; i < codes.length; i++) {
    code = codes[i];
    p = code.parentNode;
    d = document.createElement('details');
    s = document.createElement('summary');
    s.innerText = 'Details';
    // <details><summary>Details</summary></details>
    d.appendChild(s);
    // move the code into <details>
    p.replaceChild(d, code);
    d.appendChild(code);
  }
});
```
