---
title: "MultiClass ML Report"
author: "Provided by AutoQuant"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  prettydoc::html_pretty:
    theme: cayman
    toc: yes
    toc_depth: 2
    fig_caption: yes
    number_sections: no
classoption: landscape
---

```{r Environment, include=FALSE}
# theme options up top: hpstr, cayman, architect, AutoQuant
knitr::opts_chunk$set(echo = TRUE)
temp <- globalenv()
TempNames <- names(temp)
for(nam in TempNames) {
  assign(x = nam, value = eval(temp[[nam]]), envir = .GlobalEnv)
}

rt_theme_neon <- reactable::reactableTheme(
  color = "#E7ECFF",
  backgroundColor = "rgba(16, 24, 61, 0.55)",      # glass panel
  borderColor = "rgba(140, 170, 255, 0.22)",
  stripedColor = "rgba(255, 255, 255, 0.035)",
  highlightColor = "rgba(72, 145, 255, 0.12)",     # hover row glow tint
  cellPadding = "10px 12px",

  style = list(
    fontFamily = "-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif",
    fontSize = "14px",
    borderRadius = "14px",
    boxShadow = "0 10px 26px rgba(0,0,0,0.30), 0 0 18px rgba(72,145,255,0.18)",
    backdropFilter = "blur(10px)"
  ),

  headerStyle = list(
    backgroundColor = "rgba(5, 7, 26, 0.75)",
    color = "#E7ECFF",
    fontWeight = 800,
    borderBottom = "1px solid rgba(140,170,255,0.25)"
  ),

  rowStyle = list(
    borderBottom = "1px solid rgba(231,236,255,0.10)"
  ),

  cellStyle = list(
    borderRight = "1px solid rgba(231,236,255,0.06)"
  ),

  searchInputStyle = list(
    width = "100%",
    color = "#E7ECFF",
    backgroundColor = "rgba(0,0,0,0.20)",
    border = "1px solid rgba(140,170,255,0.30)",
    borderRadius = "12px",
    padding = "10px 12px",
    outline = "none"
  ),

  filterInputStyle = list(
    color = "#E7ECFF",
    backgroundColor = "rgba(0,0,0,0.20)",
    border = "1px solid rgba(140,170,255,0.28)",
    borderRadius = "10px",
    padding = "7px 10px",
    outline = "none"
  ),

  selectStyle = list(
    color = "#E7ECFF",
    backgroundColor = "rgba(0,0,0,0.20)",
    border = "1px solid rgba(140,170,255,0.28)",
    borderRadius = "10px"
  ),

  paginationStyle = list(
    color = "rgba(231,236,255,0.80)"
  ),

  pageButtonStyle = list(
    background = "rgba(72,145,255,0.12)",
    color = "#E7ECFF",
    border = "1px solid rgba(140,170,255,0.35)",
    borderRadius = "10px",
    padding = "6px 10px"
  ),

  pageButtonHoverStyle = list(
    background = "rgba(72,145,255,0.20)",
    border = "1px solid rgba(140,170,255,0.60)",
    boxShadow = "0 0 14px rgba(72,145,255,0.28)"
  ),

  pageButtonActiveStyle = list(
    background = "rgba(72,145,255,0.26)",
    border = "1px solid rgba(140,170,255,0.70)",
    boxShadow = "0 0 18px rgba(72,145,255,0.40)"
  )
)

```

```{css, echo=FALSE}
@import url('https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap');

:root{
  /* Core dark palette */
  --bg0: #070A14;
  --bg1: #0B1030;
  --bg2: #10183D;

  --panel: rgba(16, 24, 61, 0.72);
  --panel2: rgba(10, 14, 32, 0.72);

  --text: #E7ECFF;
  --muted: rgba(231, 236, 255, 0.72);

  --link: #9EC5FF;
  --linkHover: #CFE3FF;

  /* Neon glow */
  --glow: rgba(72, 145, 255, 0.40);
  --glowStrong: rgba(72, 145, 255, 0.70);
  --border: rgba(140, 170, 255, 0.30);

  --codeBg: rgba(255,255,255,0.06);
  --codeBorder: rgba(140, 170, 255, 0.22);

  --preBg: rgba(0,0,0,0.25);
  --preBorder: rgba(140, 170, 255, 0.28);

  --tableHeadBg: rgba(72, 145, 255, 0.22);
  --tableOdd: rgba(255,255,255,0.04);
  --tableEven: rgba(255,255,255,0.02);
  --tableGrid: rgba(231, 236, 255, 0.12);
}

* { box-sizing: border-box; }

html, body { height: 100%; }

body {
  padding: 0;
  margin: 0;
  font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 16px;
  line-height: 1.55;
  color: #E7ECFF;

  background:
    radial-gradient(1200px 600px at 20% -10%, rgba(72,145,255,0.20), transparent 60%),
    radial-gradient(900px 500px at 90% 10%, rgba(168,80,255,0.14), transparent 55%),
    linear-gradient(180deg, #0B1030, #070A14);

  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
}


a {
  color: var(--link);
  text-decoration: none;
}
a:hover {
  color: var(--linkHover);
  text-decoration: underline;
}

/* Header */
.page-header {
  color: var(--text);
  text-align: center;
  background-color: #05071A;
  background-image: radial-gradient(900px 400px at 50% 0%, rgba(72,145,255,0.18), transparent 70%),
                    linear-gradient(120deg, #05071A, #0E1B4E);
  padding: 1.5rem 2rem;
  border-bottom: 1px solid rgba(140,170,255,0.15);
}
.page-header :last-child { margin-bottom: 0.5rem; }
@media screen and (max-width: 42em) {
  .page-header { padding: 1rem 1rem; }
}

.project-name {
  margin-top: 0;
  margin-bottom: 0.1rem;
  font-size: 2rem;
}
@media screen and (max-width: 42em) {
  .project-name { font-size: 1.75rem; }
}

.project-tagline {
  margin-bottom: 2rem;
  font-weight: normal;
  opacity: 0.8;
  font-size: 1.5rem;
  color: var(--muted);
}
@media screen and (max-width: 42em) {
  .project-tagline { font-size: 1.2rem; }
}

.project-author, .project-date {
  font-weight: normal;
  opacity: 0.85;
  font-size: 1.2rem;
  color: var(--muted);
}
@media screen and (max-width: 42em) {
  .project-author, .project-date { font-size: 1rem; }
}

/* Main layout */
.main-content, .toc {
  max-width: 95%;
  padding: 2rem 4rem;
  margin: 0 auto;
  font-size: 1.06rem;
}

@media screen and (min-width: 42em) and (max-width: 64em) {
  .main-content, .toc { padding: 2rem; }
}
@media screen and (max-width: 42em) {
  .main-content, .toc {
    padding: 2rem 1rem;
    font-size: 1rem;
  }
}

.main-content :first-child { margin-top: 0; }
.main-content img { max-width: 100%; }

/* TOC */
.toc { padding-bottom: 0; }

.toc .toc-box {
  padding: 48px;
  background: linear-gradient(90deg, rgba(5,7,26,0.90), rgba(16,24,61,0.70));
  border: 1px solid rgba(140,170,255,0.20);
  border-radius: 44px;
  color: var(--text);
  box-shadow:
    0 10px 30px rgba(0,0,0,0.35),
    0 0 24px var(--glow);
  backdrop-filter: blur(10px);
}
.toc .toc-box .toc-title {
  margin: 0 0 0.5rem;
  text-align: center;
}
.toc .toc-box > ul { margin: 0; padding-left: 1.5rem; }

/* Headings */
.main-content h1,
.main-content h2,
.main-content h3,
.main-content h4,
.main-content h5,
.main-content h6 {
  margin-top: 2rem;
  margin-bottom: 1rem;
  font-weight: 700;
  letter-spacing: 0.2px;
  color: var(--text);
}

.main-content h1 { font-size: 2.0rem; }
.main-content h2 { font-size: 1.6rem; opacity: 0.95; }
.main-content h3 { font-size: 1.35rem; opacity: 0.92; }
.main-content h4 { font-size: 1.15rem; opacity: 0.90; }
.main-content h5 { font-size: 1.05rem; opacity: 0.88; }
.main-content h6 { font-size: 1.0rem; opacity: 0.86; }

/* Paragraphs */
.main-content p { margin-bottom: 1em; color: var(--text); }

/* Inline code */
.main-content code {
  padding: 2px 6px;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  color: var(--text);
  background-color: var(--codeBg);
  border: 1px solid var(--codeBorder);
  border-radius: 0.45rem;
}

/* Code blocks */
.main-content pre {
  padding: 0.9rem 1rem;
  margin-top: 0;
  margin-bottom: 1rem;

  font: 0.98rem Consolas, "Liberation Mono", Menlo, Courier, monospace;
  color: var(--text);

  background-color: var(--preBg);
  border: 1px solid var(--preBorder);
  border-radius: 0.75rem;
  line-height: 1.45;
  overflow: auto;

  box-shadow:
    0 10px 24px rgba(0,0,0,0.35),
    0 0 18px rgba(72,145,255,0.16);
}
@media screen and (max-width: 42em) {
  .main-content pre { font-size: 0.9rem; }
}

.main-content pre > code {
  padding: 0;
  margin: 0;
  color: var(--text);
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

/* Lists */
.main-content ul, .main-content ol { margin-top: 0; }

/* Blockquotes */
.main-content blockquote {
  padding: 0.25rem 1rem;
  margin-left: 0;
  color: var(--muted);
  border-left: 0.3rem solid rgba(72,145,255,0.45);
  background: rgba(255,255,255,0.03);
  border-radius: 0.6rem;
}
@media screen and (max-width: 42em) {
  .main-content blockquote { font-size: 1.05rem; }
}

/* HR */
.main-content hr {
  height: 1px;
  padding: 0;
  margin: 1.25rem 0;
  background-color: rgba(231,236,255,0.12);
  border: 0;
}

/* ============================
   DETAILS: glow box + hover glow
   ============================ */
.main-content details {
  margin: 1rem 0;
  padding: 0.85rem 1rem;
  border-radius: 0.95rem;

  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border: 1px solid var(--border);

  box-shadow:
    0 10px 26px rgba(0,0,0,0.35),
    0 0 18px var(--glow);

  transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
  backdrop-filter: blur(10px);
}

.main-content details:hover {
  transform: translateY(-1px);
  border-color: rgba(140,170,255,0.55);
  box-shadow:
    0 14px 34px rgba(0,0,0,0.45),
    0 0 26px var(--glowStrong);
}

.main-content details[open] {
  border-color: rgba(140,170,255,0.60);
  box-shadow:
    0 14px 34px rgba(0,0,0,0.45),
    0 0 28px var(--glowStrong);
}

.main-content details > summary {
  cursor: pointer;
  user-select: none;
  font-weight: 700;
  color: var(--text);
  list-style: none;
  display: flex;
  align-items: center;
  gap: 10px;
}

.main-content details > summary::-webkit-details-marker { display: none; }

.main-content details > summary::before {
  content: "â–¸";
  display: inline-block;
  transform: translateY(-1px);
  opacity: 0.85;
  transition: transform 140ms ease;
}

.main-content details[open] > summary::before {
  transform: rotate(90deg) translateY(-1px);
}

/* Inner content spacing inside details */
.main-content details > *:not(summary) {
  margin-top: 0.85rem;
}

/* ============================
   TABLES (dark) + wrapper hooks
   ============================ */
.main-content table {
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
  -webkit-overflow-scrolling: touch;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 0.75rem 0;
  color: var(--text);
}

.main-content table th {
  font-weight: 800;
  background-color: var(--tableHeadBg);
  color: var(--text);
  border-bottom: 1px solid var(--tableGrid);
}

.main-content table th,
.main-content table td {
  padding: 0.55rem 0.85rem;
  border-bottom: 1px solid var(--tableGrid);
  text-align: left;
}

.main-content table tr:nth-child(odd) { background-color: var(--tableOdd); }
.main-content table tr:nth-child(even) { background-color: var(--tableEven); }

/* Wrapper that JS will create around tables */
.table-wrap {
  margin: 1rem 0 1.25rem;
  padding: 0.75rem 0.9rem;
  border-radius: 0.95rem;
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border: 1px solid rgba(140,170,255,0.22);
  box-shadow:
    0 10px 26px rgba(0,0,0,0.30),
    0 0 18px rgba(72,145,255,0.18);
}

.table-toolbar {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-bottom: 0.6rem;
}

.table-btn {
  appearance: none;
  border: 1px solid rgba(140,170,255,0.40);
  background: rgba(72,145,255,0.14);
  color: var(--text);
  padding: 7px 10px;
  border-radius: 0.7rem;
  cursor: pointer;
  font-weight: 700;
  letter-spacing: 0.2px;
  transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease, background 120ms ease;
}

.table-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(140,170,255,0.70);
  background: rgba(72,145,255,0.22);
  box-shadow: 0 0 18px rgba(72,145,255,0.35);
}

.table-btn:active {
  transform: translateY(0px);
}

/* Definition lists */
.main-content dl { padding: 0; }
.main-content dl dt {
  padding: 0;
  margin-top: 1rem;
  font-size: 1rem;
  font-weight: 800;
  color: var(--text);
}
.main-content dl dd {
  padding: 0;
  margin-bottom: 1rem;
  color: var(--muted);
}

/* Reactable: focus glow + small polish */
.reactable .rt-search input:focus,
.reactable .rt-filter input:focus,
.reactable select:focus {
  border-color: rgba(140,170,255,0.70) !important;
  box-shadow: 0 0 0 3px rgba(72,145,255,0.18), 0 0 18px rgba(72,145,255,0.30) !important;
}

/* Reactable: soften grid + round the whole widget */
.reactable {
  border-radius: 14px;
  overflow: hidden; /* keeps rounded corners clean */
}

/* Scrollbar polish (Chrome/Edge) */
.reactable ::-webkit-scrollbar { height: 10px; width: 10px; }
.reactable ::-webkit-scrollbar-track { background: rgba(0,0,0,0.15); border-radius: 999px; }
.reactable ::-webkit-scrollbar-thumb { background: rgba(140,170,255,0.25); border-radius: 999px; }
.reactable ::-webkit-scrollbar-thumb:hover { background: rgba(140,170,255,0.40); }

.reactable {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
}

.reactable::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 16px;
  padding: 1px;
  background: linear-gradient(
    135deg,
    rgba(72,145,255,0.7),
    rgba(168,80,255,0.5),
    rgba(72,145,255,0.7)
  );
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
}

.reactable .rt-tbody .rt-tr:hover {
  background: rgba(72,145,255,0.12) !important;
  box-shadow: inset 0 0 18px rgba(72,145,255,0.18);
}
.reactable .rt-tr {
  transition: background 120ms ease, box-shadow 120ms ease;
}

.reactable .rt-pagination button {
  transition: all 120ms ease;
}

```

```{r ModelObject_Model_MetaData, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # Model MetaData ----

  ## Model_MetaData_Parameters ----
  ArgsList <- ModelObject[['ArgsList']]
  
  ## Model_MetaData_GridMetrics ----
  GridMetrics <- ModelObject[['GridMetrics']]
  
}
``` 

```{r ModelObject_DataSets_And_MetaData, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # DataSets
  TestData <- ModelObject[['TestData']]
  ValidationData <- ModelObject[['ValidationData']]
  TrainData <- ModelObject[['TrainData']]
  
  # Meta info
  TargetColumnName <- ModelObject[['ArgsList']][['TargetColumnName']]
  TargetLevels <- ModelObject[['ArgsList']][['TargetLevels']]
  PredictionColumnName <- PredictionColumnName
  if(is.null(FeatureColumnNames)) {
    FeatureColumnNames <- ModelObject[['ColNames']][[1L]]
  }
}
```

```{r ModelObject_Evaluation_Metrics, echo = FALSE}
if(!is.null(ModelObject)) {
  
  # Evaluation Metrics ----
  
  ## MultiClass Metrics ----
  Test_MultiClassMetrics <- ModelObject[['MultinomialMetrics']][['TestData']]
  Train_MultiClassMetrics <- ModelObject[['MultinomialMetrics']][['TrainData']]

  # Update Colnames
  if(!is.null(Test_MultiClassMetrics)) Test_MultiClassMetrics[, Data_Source := 'Test']
  if(!is.null(Train_MultiClassMetrics)) Train_MultiClassMetrics[, Data_Source := 'Train']

  # Metrics
  if(is.null(Test_MultiClassMetrics) && is.null(Train_MultiClassMetrics)) {
    All_MultiClassMetrics <- NULL
  } else if(!is.null(Test_MultiClassMetrics) && !is.null(Train_MultiClassMetrics)) {
    All_MultiClassMetrics <- data.table::rbindlist(list(
      Test_MultiClassMetrics, Train_MultiClassMetrics))
  } else if(is.null(Test_MultiClassMetrics) && !is.null(Train_MultiClassMetrics)) {
    All_MultiClassMetrics <- Train_MultiClassMetrics
  } else if(!is.null(Test_MultiClassMetrics) && is.null(Train_MultiClassMetrics)) {
    All_MultiClassMetrics <- Test_MultiClassMetrics
  } else {
    All_MultiClassMetrics <- NULL
  }
  
  
  ## Model_Evaluation_Metrics ----
  EvalMetricsNames <- names(ModelObject[['EvaluationMetrics']])
  Test_EvalMetricss <- EvalMetricsNames[which(EvalMetricsNames %like% 'TestData_')]
  Test_EvalMetrics <- list()
  for(nam in Test_EvalMetricss) Test_EvalMetrics[[nam]] <- ModelObject[['EvaluationMetrics']][[nam]]
  Train_EvalMetricss <- setdiff(EvalMetricsNames, Test_EvalMetricss)
  Train_EvalMetrics <- list()
  for(nam in Train_EvalMetricss) Train_EvalMetrics[[nam]] <- ModelObject[['EvaluationMetrics']][[nam]]
  
  ## Model_VarImportanceTable ----
  if(tolower(Algo) == 'catboost') {
    
    # Store data
    Test_Importance <- ModelObject[['VariableImportance']][['Test_Importance']]
    Validation_Importance <- ModelObject[['VariableImportance']][['Validation_Importance']]
    Train_Importance <- ModelObject[['VariableImportance']][['Train_Importance']]

    # Update Colnames
    if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = 'Importance', new = 'Test_Importance', skip_absent = TRUE)
    if(!is.null(Validation_Importance)) data.table::setnames(Validation_Importance, old = 'Importance', new = 'Validation_Importance', skip_absent = TRUE)
    if(!is.null(Train_Importance)) data.table::setnames(Train_Importance, old = 'Importance', new = 'Train_Importance', skip_absent = TRUE)

    # CatBoost only
    if(is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- NULL
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
      All_Importance <- merge(All_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Validation_Importance, by = 'Variable', all = TRUE)
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Test_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- merge(Validation_Importance, Train_Importance, by = 'Variable', all = TRUE)
    } else if(is.null(Test_Importance) && is.null(Validation_Importance) && !is.null(Train_Importance)) {
      All_Importance <- Train_Importance
    } else if(is.null(Test_Importance) && !is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Validation_Importance
    } else if(!is.null(Test_Importance) && is.null(Validation_Importance) && is.null(Train_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }

  } else {

    # Store data (xgb check, )
    Test_Importance <- ModelObject[['VariableImportance']]
    Validation_Importance <- NULL
    Train_Importance <- NULL
    
    # Update Colnames
    if(Algo %in% c("xgboost","lightgbm")) {
      if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = names(Test_Importance)[2], new = 'Test_Importance', skip_absent = TRUE)
    } else {
      # h2o col 3 is scaled importance which is preferred
      if(!is.null(Test_Importance)) data.table::setnames(Test_Importance, old = names(Test_Importance)[3], new = 'Test_Importance', skip_absent = TRUE)
    }
    
    # Non CatBoost only
    if(!is.null(Test_Importance)) {
      All_Importance <- Test_Importance
    } else {
      All_Importance <- NULL
    }
    
  }
  
  All_Interaction <- NULL
}
``` 

```{r Generic_Evaluation_Plots, echo = FALSE}

options(warn = -1)

# Evaluation Plots ----

## EvaluationPlots_CalibrationPlot ----

### Test ----
if(!is.null(TestData)) {
  Test_EvaluationPlot <- AutoPlots::Plot.Calibration.Line(
    dt = TestData,
    AggMethod = "mean",
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 21,
    #Height = "600px",
    #Width = "975px",
    Title = "Calibration Plot: Test Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)

} else {
  Test_EvaluationPlot <- NULL
}

### Train ----
if(!is.null(TrainData)) {
  Train_EvaluationPlot <- AutoPlots::Plot.Calibration.Line(
    dt = TrainData,
    AggMethod = "mean",
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 21,
    #Height = "600px",
    #Width = "975px",
    Title = "Calibration Plot: Train Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)

} else {
  Train_EvaluationPlot <- NULL
}

## EvaluationPlots_ROC_Plot ----

### TestData ----
if(!is.null(TestData)) {
  Test_ROCPlot <- AutoPlots::Plot.ROC(
    dt = TestData,
    SampleSize = 10000,
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    #Height = "600px",
    #Width = "975px",
    Title = "Calibration Plot: Test Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)
  
} else {
  Test_ROCPlot <- NULL
}

### TrainData ----
if(!is.null(TrainData)) {
  Train_ROCPlot <- AutoPlots::Plot.ROC(
    dt = TrainData,
    SampleSize = 10000,
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    #Height = "600px",
    #Width = "975px",
    Title = "Calibration Plot: Train Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)
} else {
  Train_ROCPlot <- NULL
}

## EvaluationPlots_GainsPlots ----

## Test_CumGainsChart ----
if(!is.null(TestData)) {
  Test_CumGainsChart <- AutoPlots::Plot.Gains(
    dt = TestData,
    PreAgg = FALSE,
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    ZVar = "N",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    ZVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 20,
    #Height = "600px",
    #Width = "975px",
    Title = "Gains Plot: Test Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)
} else {
  Test_CumGainsChart <- NULL
}

## Train_CumGainsChart ----
if(!is.null(TrainData)) {
  Train_CumGainsChart <- AutoPlots::Plot.Gains(
    dt = TrainData,
    PreAgg = FALSE,
    XVar = PredictionColumnName,
    YVar = TargetColumnName,
    ZVar = "N",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    ZVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    NumberBins = 20,
    #Height = "600px",
    #Width = "975px",
    Title = "Gains Plot: Train Data",
    ShowLabels = FALSE,
    Title.YAxis = TargetColumnName,
    Title.XAxis = "Predict",
    EchartsTheme = "wef",
    TimeLine = TRUE,
    
    
    TextColor = "white",
    Debug = FALSE)
} else {
  Train_CumGainsChart <- NULL
}
```

```{r ModelObject_Model_Interpretation, echo = FALSE}

# Model Interpretation ----

## Model_Evaluation_Metrics_NumericVariables ----

### TestData ----

# Plots to Add and Remove

# Extra list mgt + par dep plot for multinomial

# Numeric-Test: Starting batch of plots
  
# Name to keep and remove
Test_ParDepPlots <- list()

# Add Plots to List per User Request
if(!is.null(TestData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TestData[[g]])) {
      Test_ParDepPlots[[g]] <- AutoPlots::Plot.PartialDependence.Line(
        dt = TestData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        #Height = "600px",
        #Width = "975px",
        Title = "Partial Dependence Line: Test Data",
        ShowLabels = FALSE,
        Title.YAxis = TargetColumnName,
        Title.XAxis = g,
        EchartsTheme = "wef",
        TimeLine = TRUE,
        
        
        TextColor = "white",
        Debug = FALSE)
    }
  }
}


### TrainData ----

# Plots to Add and Remove

# Extra list mgt + par dep plot for multinomial

# Numeric-Train: Starting batch of plots
Train_ParDepPlots <- list()

# Add Plots to List per User Request
if(!is.null(TrainData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.numeric(TestData[[g]])) {
      Train_ParDepPlots[[g]] <- AutoPlots::Plot.PartialDependence.Line(
        dt = TrainData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        #Height = "600px",
        #Width = "975px",
        Title = "Partial Dependence Line: Train Data",
        ShowLabels = FALSE,
        Title.YAxis = TargetColumnName,
        Title.XAxis = g,
        EchartsTheme = "wef",
        TimeLine = TRUE,
        
        
        TextColor = "white",
        Debug = FALSE)
    }
  }
}
  
## Model_Evaluation_Metrics_CategoricalVariables ---- 

### Test Data ----

# Starting batch of plots
Test_ParDepCatPlots <- list()
  
# Add Plots
if(!is.null(TestData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.character(TestData[[g]]) || is.factor(TestData[[g]])) {
      Test_ParDepCatPlots[[g]] <- tryCatch({AutoPlots::Plot.PartialDependence.HeatMap(
        dt = TestData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        #Height = "600px",
        #Width = "975px",
        Title = "Partial Dependence Heatmap: Test Data",
        ShowLabels = FALSE,
        Title.YAxis = TargetColumnName,
        Title.XAxis = g,
        EchartsTheme = "wef",
        TimeLine = TRUE,
        
        
        TextColor = "white",
        Debug = FALSE)}, error = function(x) NULL)
    }
  }
}
  
### Train Data ----

# Starting batch of plots
Train_ParDepCatPlots <- list()

# Add Plots
if(!is.null(TrainData) && !is.null(FeatureColumnNames)) {
  for(g in FeatureColumnNames) {
    if(is.character(TrainData[[g]]) || is.factor(TrainData[[g]])) {
      Train_ParDepCatPlots[[g]] <- tryCatch({AutoPlots::Plot.PartialDependence.HeatMap(
        dt = TrainData,
        XVar = g,
        YVar = TargetColumnName,
        ZVar = 'Predict',
        YVarTrans = "Identity",
        XVarTrans = "Identity",
        ZVarTrans = "Identity",
        FacetRows = 1,
        FacetCols = 1,
        FacetLevels = NULL,
        GroupVar = NULL,
        NumberBins = 20,
        AggMethod = "mean",
        #Height = "600px",
        #Width = "975px",
        Title = "Partial Dependence Heatmap: Train Data",
        ShowLabels = FALSE,
        Title.YAxis = TargetColumnName,
        Title.XAxis = g,
        EchartsTheme = "wef",
        TimeLine = TRUE,
        
        
        TextColor = "white",
        Debug = FALSE)}, error = function(x) NULL)
    }
  }
}

```

# <font size="6">ML Report Descriptions:</font>

The two main goals with this document are to provide a wide range of output to investigate high level performance and insights, and to deliver a high quality report design layout to increase user experience. The metrics provided are intended to be semi-comprehensive. One can always dig deeper into results to gain further insights. In light of that, the results are intended to provide information that one can come to a reasonable conclusion about their model or to find the areas where they need to dig a little deeper. 

## Evaluation Metrics
This section contains statistics and variable importance measures to help the user understand model performance at a high level. Train Data results are included and can be used to compare against the Test Data results to identify over / under fitting of models.

## Evaluation Plots 
This section contains visualizations that span the range of predicted values and the associated accuracies across that range. The predicted values range is broken up into every 5th percentile to provide a wide range for evaluation.

## Model Interpretation sections 
This section contains visualizations intended to open up the black box of your algorithm. When one inspects coefficients from a regression model, the insights they gain are two-fold: 
- get an understanding about statistics significance
- gain an understanding of the variable's effect on the target variable
However, not all relationships are linear and sometimes the user doesn't specifiy an appropriate model structure to fully capture the nature of the relationship, which can lead to incorrect conclusions about both statistical signifance and the nature of the relationship. These visualizations provide a way to understand what the exact nature of those relationships are (in a visual manner) and if the user chooses, they can attempt to fit the relationship more precisely with an appropriate statistical model in order to gain a better understanding of statistical significance.

# <font size="6">Evaluation Metrics</font>
<p>

<details><summary>Expand</summary>
<p>



##  <font size="5">MultiClass Metrics Tables</font>

<details><summary>MultiClass Metrics</summary>
<p>

```{r Model_MultiClass_Metrics, echo=FALSE}
if(!is.null(All_MultiClassMetrics)) {
  All_MultiClassMetrics <- All_MultiClassMetrics[Data_Source != 'Train']
  data.table::setcolorder(All_MultiClassMetrics, c(3L, 1L, 2L))
  reactable::reactable(
    data = All_MultiClassMetrics,
    width = "100%",
    fullWidth = TRUE,
    compact = TRUE,
    defaultPageSize = 10,
    wrap = FALSE,
    filterable = TRUE,
    highlight = TRUE,
    pagination = TRUE,
    resizable = TRUE,
    searchable = TRUE,
    selection = "multiple",
    showPagination = TRUE,
    showSortable = TRUE,
    showSortIcon = TRUE,
    sortable = TRUE,
    striped = TRUE,
    theme = rt_theme_neon
  )
} else {
  print('All_MultiClassMetrics is NULL')
}
```

</details>
</p>


##  <font size="5">Binary Metrics 1 vs All Tables</font>

<details><summary>Model Metrics Tables</summary>
<p>


### **TestData**
<p>

<details><summary>Performance Metrics</summary>
<p>

```{r Model_Evaluation_Metrics, echo=FALSE}
if(!is.null(Test_EvalMetrics)) {
  for(nam in names(Test_EvalMetrics)) {
    print(nam)
    reactable::reactable(
      data = Test_EvalMetrics[[nam]],
      width = "100%",
      fullWidth = TRUE,
      compact = TRUE,
      defaultPageSize = 10,
      wrap = FALSE,
      filterable = TRUE,
      highlight = TRUE,
      pagination = TRUE,
      resizable = TRUE,
      searchable = TRUE,
      selection = "multiple",
      showPagination = TRUE,
      showSortable = TRUE,
      showSortIcon = TRUE,
      sortable = TRUE,
      striped = TRUE,
      theme = rt_theme_neon
    )
  }
} else {
  print('Test_EvalMetrics is NULL')
}
```

</details>
</p>


### **TrainData + ValidationData**
<p>

<details><summary>Performance Metrics</summary>
<p>

```{r Model_Evaluation_Metrics_Train, echo=FALSE}
if(!is.null(Train_EvalMetrics)) {
  for(nam in names(Train_EvalMetrics)) {
    print(nam)
    reactable::reactable(
      data = Train_EvalMetrics[[nam]],
      width = "100%",
      fullWidth = TRUE,
      compact = TRUE,
      defaultPageSize = 10,
      wrap = FALSE,
      filterable = TRUE,
      highlight = TRUE,
      pagination = TRUE,
      resizable = TRUE,
      searchable = TRUE,
      selection = "multiple",
      showPagination = TRUE,
      showSortable = TRUE,
      showSortIcon = TRUE,
      sortable = TRUE,
      striped = TRUE,
      theme = rt_theme_neon
    )
  }
} else {
  print('Train_EvalMetrics is NULL')
}
```

</details>
</p>






##  <font size="5">Variable Importance Table</font>

<details><summary>Variable Importance</summary>
<p>

```{r Model_VarImportanceTable, echo=FALSE}
if(!is.null(All_Importance)) {
  data.table::setorderv(x = All_Importance, cols = names(All_Importance)[2L], order = -1L, na.last = TRUE)
  reactable::reactable(
    data = All_Importance,
    width = "100%",
      fullWidth = TRUE,
      compact = TRUE,
      defaultPageSize = 10,
      wrap = FALSE,
      filterable = TRUE,
      highlight = TRUE,
      pagination = TRUE,
      resizable = TRUE,
      searchable = TRUE,
      selection = "multiple",
      showPagination = TRUE,
      showSortable = TRUE,
      showSortIcon = TRUE,
      sortable = TRUE,
      striped = TRUE,
      theme = rt_theme_neon
  )
} else {
  print("No Importance data was provided")
}
```

</details>
</p>


##  <font size="5">Interaction Importance Table</font>
<p>

<details><summary>Interaction Importance</summary>
<p>

```{r Model_IntImportanceTable, echo=FALSE}
if(exists("All_Interaction") && !is.null(All_Interaction)) {
  data.table::setorderv(x = All_Interaction, cols = names(All_Interaction)[3L], order = -1L, na.last = TRUE)
  reactable::reactable(
    data = All_Interaction,
    width = "100%",
      fullWidth = TRUE,
      compact = TRUE,
      defaultPageSize = 10,
      wrap = FALSE,
      filterable = TRUE,
      highlight = TRUE,
      pagination = TRUE,
      resizable = TRUE,
      searchable = TRUE,
      selection = "multiple",
      showPagination = TRUE,
      showSortable = TRUE,
      showSortIcon = TRUE,
      sortable = TRUE,
      striped = TRUE,
      theme = rt_theme_neon
  )
} else {
  print('Interaction importance is only available with CatBoost')
}
```

</details>
</p>


</details>
</p>


# <font size="6">Evaluation Plots</font>
<p>

<details><summary>Expand</summary>
<p>



## <font size="5">Variable Importance Plots</font>
<p>

<details><summary>Expand</summary>
<p>

```{r EvaluationPlots_VIPlot, echo=FALSE}
if(!is.null(Test_Importance)) {
  if("Train_Importance" %in% names(Test_Importance)) data.table::setnames(Test_Importance, 'Train_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Test_Importance)) data.table::setnames(Test_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Test_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    #Height = "600px",
    #Width = "975px",
    Title = "Variable Importance Plot: Test Data",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    EchartsTheme = "wef",
    TimeLine = FALSE,
    
    
    TextColor = "white",
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
} else {
  print("Test_Importance is NULL")
}
if(!is.null(Validation_Importance)) {
  if("Validation_Importance" %in% names(Validation_Importance)) data.table::setnames(Validation_Importance, 'Validation_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Validation_Importance)) data.table::setnames(Validation_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Validation_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    #Height = "600px",
    #Width = "975px",
    Title = "Variable Importance Plot: Validation Data",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    EchartsTheme = "wef",
    TimeLine = FALSE,
    
    
    TextColor = "white",
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
}
if(!is.null(Train_Importance)) {
  if("Train_Importance" %in% names(Train_Importance)) data.table::setnames(Train_Importance, 'Train_Importance', 'Importance', skip_absent = TRUE)
  if("Test_Importance" %in% names(Train_Importance)) data.table::setnames(Train_Importance, "Test_Importance", "Importance", skip_absent = TRUE)
  AutoPlots::Plot.VariableImportance(
    dt = Train_Importance,
    XVar = "Importance",
    YVar = "Variable",
    GroupVar = NULL,
    YVarTrans = "Identity",
    XVarTrans = "Identity",
    FacetRows = 1,
    FacetCols = 1,
    FacetLevels = NULL,
    AggMethod = "mean",
    #Height = "600px",
    #Width = "975px",
    Title = "Variable Importance Plot: Train Data",
    ShowLabels = FALSE,
    Title.YAxis = NULL,
    Title.XAxis = NULL,
    EchartsTheme = "wef",
    TimeLine = FALSE,
    
    
    TextColor = "white",
    title.fontSize = 22,
    title.fontWeight = "bold",
    title.textShadowColor = "#63aeff",
    title.textShadowBlur = 3,
    title.textShadowOffsetY = 1,
    title.textShadowOffsetX = -1,
    xaxis.fontSize = 14,
    yaxis.fontSize = 14,
    Debug = FALSE)
  
}
```

</details>
</p>


## <font size="5">Calibration Plots</font>
<p>

<details><summary>Expand</summary>
<p>

### **TestData**
<p>

<details><summary>Calibration Plot</summary>
<p>

```{r EvaluationPlots_CalibrationPlot, echo=FALSE}
if(!is.null(Test_EvaluationPlot)) {
  eval(Test_EvaluationPlot)
} else {
  print('Test_EvaluationPlot is NULL or TestData is NULL')
}
```

</details>
</p>

### **TrainData** + **ValidationData**
<p>

<details><summary>Calibration Plot</summary>
<p>

```{r EvaluationPlots_CalibrationPlot_Train, echo=FALSE}
if(!is.null(Train_EvaluationPlot)) {
  eval(Train_EvaluationPlot)
} else {
  print('Train Data was not supplied')
}
```

</details>
</p>




## <font size="5">ROC Plots</font>
<p>

<details><summary>Expand</summary>
<p>

### **TestData**
<p>

<details><summary>ROC Plots</summary>
<p>

```{r ROC_Plot, echo=FALSE}
if(!is.null(Test_ROCPlot)) {
  eval(Test_ROCPlot)
} else {
  print('Test_ROCPlot is NULL or TestData is NULL')
}
```

</details>
</p>

### **TrainData** + **ValidationData**
<p>

<details><summary>Expand</summary>
<p>

```{r ROC_Plot_Train, echo=FALSE}
if(!is.null(Train_EvaluationPlot)) {
  eval(Train_ROCPlot)
} else {
  print('Train Data was not supplied')
}
```

</details>
</p>




## <font size="5">Lift & Gains Plots</font>
<p>

<details><summary>Expand</summary>
<p>

### **TestData**
<p>

<details><summary>Lift & Gains Plots</summary>
<p>

```{r Lift and Gains, echo=FALSE}
if(!is.null(Test_CumGainsChart)) {
  eval(Test_CumGainsChart)
} else {
  print('Test_CumGainsChart is NULL or TestData is NULL')
}
```

</details>
</p>

### **TrainData** + **ValidationData**
<p>

<details><summary>Expand</summary>
<p>

```{r Lift and Gains_Train, echo=FALSE}
if(!is.null(Test_CumGainsChart)) {
  eval(Train_CumGainsChart)
} else {
  print('Train Data was not supplied')
}
```

</details>
</p>






# <font size="6">Model Interpretation</font>
<p>

<details><summary>Expand</summary>
<p>



## <font size="5">Partial Dependence Plots: Numeric-Features</font> 
<p>

<details><summary>Expand</summary>
<p>


### Partial Dependence Line Plots
<p>

<details><summary>Expand</summary>
<p>


#### **TestData**
<p>

<details><summary>Partital Dependence Line Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables, echo=FALSE}
options(warn = -1)
if(!is.null(Test_ParDepPlots) && length(Test_ParDepPlots) > 0) {
  echarts4r::e_arrange(Test_ParDepPlots)
} else {
  print('Test_ParDepPlots is NULL and TestData is NULL')
}
options(warn = 1)
```

</details>
</p>


#### **TrainData** + **ValidationData**
<p>

<details><summary>Partital Dependence Line Plots</summary>
<p>

```{r Model_Evaluation_Metrics_NumericVariables_Train, echo=FALSE}
options(warn = -1)
if(!is.null(Train_ParDepPlots) && length(Train_ParDepPlots) > 0) {
  echarts4r::e_arrange(Train_ParDepPlots)
} else {
  print('Train Data was not supplied')
}
options(warn = 1)
```

</details>
</p>



## <font size="5">Partial Partial Dependence Plots: Categorical-Features</font>
<p>

<details><summary>Expand</summary>
<p>


### **TestData**
<p>

<details><summary>Partital Dependence Bar Plots</summary>
<p>

```{r Model_Evaluation_Metrics_CategoricalVariables, echo=FALSE}
options(warn = -1)
if(!is.null(Test_ParDepCatPlots) && length(Test_ParDepCatPlots) > 0) {
  echarts4r::e_arrange(Test_ParDepCatPlots)
} else {
  print('Categorical variables were not supplied')
}
options(warn = 1)
```

</details>
</p>


### **TrainData** + **ValidationData**
<p>

<details><summary>Partital Dependence Bar Plots</summary>
<p>

```{r Model_Evaluation_Metrics_CategoricalVariables_Train, echo=FALSE}
options(warn = -1)
if(!is.null(Train_ParDepCatPlots) && length(Train_ParDepCatPlots) > 0) {
  echarts4r::e_arrange(Train_ParDepCatPlots)
} else {
  print('Train Data was not supplied')
}
options(warn = 1)
```

</details>
</p>


</details>
</p>



</details>
</p>






# <font size="6">Model MetaData</font>
<p>

<details><summary>Expand</summary>
<p>


## <font size="5">Parameters and Settings</font> 

<details><summary>Model Parameters</summary>
<p>

```{r Model_MetaData_Parameters, echo=FALSE}
if(!is.null(ArgsList)) {
  for(nam in names(ArgsList)) print(paste0(nam, ": ", ArgsList[[nam]]))
} else {
  txt <- paste0(ModelID, "_ArgsList.Rdata")
  print(paste0('ArgsList is NULL'))
}
```



## <font size="5">Grid Tuning Metrics</font>

<details><summary>Grid Tuning Metrics</summary>
<p>

```{r Model_MetaData_GridMetrics, echo=FALSE}
if(!is.null(GridMetrics)) {
  reactable::reactable(
    data = GridMetrics[order(-MetricValue)],
    width = "100%",
    fullWidth = TRUE,
    compact = TRUE,
    defaultPageSize = 10,
    wrap = FALSE,
    filterable = TRUE,
    highlight = TRUE,
    pagination = TRUE,
    resizable = TRUE,
    searchable = TRUE,
    selection = "multiple",
    showPagination = TRUE,
    showSortable = TRUE,
    showSortIcon = TRUE,
    sortable = TRUE,
    striped = TRUE,
    theme = rt_theme_neon
  )
  
} else {
  print("GridTuning was not conducted")
}
```

</details>
</p>



</details>
</p>

```{js, echo=FALSE}
<script>
(function() {
  function tableToCSV(table) {
    const rows = Array.from(table.querySelectorAll('tr'));
    return rows.map(row => {
      const cells = Array.from(row.querySelectorAll('th,td'));
      return cells.map(cell => {
        let text = (cell.innerText || '').replace(/\r?\n|\r/g, ' ').trim();
        text = '"' + text.replace(/"/g, '""') + '"';
        return text;
      }).join(',');
    }).join('\n');
  }

  function downloadText(filename, text) {
    const blob = new Blob([text], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(url);
    a.remove();
  }

  function safeName(s) {
    return (s || 'table')
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '_')
      .replace(/^_+|_+$/g, '')
      .slice(0, 60) || 'table';
  }

  function inferFilename(table, idx) {
    // Prefer caption if present
    const cap = table.querySelector('caption');
    if (cap && cap.textContent.trim()) return safeName(cap.textContent) + '.csv';

    // Else, nearest preceding heading
    const headings = Array.from(document.querySelectorAll('.main-content h1,.main-content h2,.main-content h3,.main-content h4,.main-content h5,.main-content h6'));
    const tRect = table.getBoundingClientRect();
    let best = null;

    for (const h of headings) {
      const hRect = h.getBoundingClientRect();
      // heading above the table (rough heuristic)
      if (hRect.top < tRect.top + window.scrollY) best = h;
    }
    if (best && best.textContent.trim()) return safeName(best.textContent) + '.csv';

    return 'table_' + (idx + 1) + '.csv';
  }

  function wrapTable(table) {
    if (table.closest('.table-wrap')) return;

    const wrap = document.createElement('div');
    wrap.className = 'table-wrap';

    const toolbar = document.createElement('div');
    toolbar.className = 'table-toolbar';

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'table-btn';
    btn.textContent = 'Download CSV';

    toolbar.appendChild(btn);

    // wrap insertion
    table.parentNode.insertBefore(wrap, table);
    wrap.appendChild(toolbar);
    wrap.appendChild(table);

    return btn;
  }

  function init() {
    const tables = document.querySelectorAll('.main-content table');
    tables.forEach((table, i) => {
      const btn = wrapTable(table);
      if (!btn) return;

      btn.addEventListener('click', function() {
        const filename = inferFilename(table, i);
        const csv = tableToCSV(table);
        downloadText(filename, csv);
      });
    });
  }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>
```
